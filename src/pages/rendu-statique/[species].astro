---
import Layout from "../../layouts/Layout.astro";
import penguins from "../../assets/penguins.json";
import PlotFigure from "../../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";

// 🧩 Génération statique des pages à la construction du site
export async function getStaticPaths() {
  const speciesList = [...new Set(penguins.map(p => p.species))];
  return speciesList.map(species => ({
    params: { species },
  }));
}

const { species } = Astro.params;
const filteredPenguins = penguins.filter(p => p.species === species);
---

<Layout>
  <main class="max-w-5xl mx-auto py-10 px-6">
    <section class="text-center mb-10">
      <h1 class="text-3xl font-semibold text-blue-600 mb-2">
        🐧 Espèce : {species}
      </h1>
      <p class="text-gray-600">
        {filteredPenguins.length} pingouins trouvés — page générée statiquement.
      </p>
    </section>

    <div class="bg-white border border-gray-200 rounded-2xl shadow-md p-6">
      <PlotFigure
        options={{
          grid: true,
          marks: [
            Plot.dot(filteredPenguins, {
              x: "culmen_length_mm",
              y: "culmen_depth_mm",
              stroke: "species",
              fill: "steelblue",
              r: 5,
              fillOpacity: 0.7,
            }),
          ],
          x: { label: "Longueur du bec (mm)" },
          y: { label: "Profondeur du bec (mm)" },
          title: `Graphique des ${species}`,
        }}
      />
    </div>

    <div class="text-center mt-8">
      <a
        href="/rendu-statique"
        class="inline-block px-5 py-2 text-sm font-medium text-blue-600 border border-blue-600 rounded-full hover:bg-blue-600 hover:text-white transition-colors duration-200"
      >
        ← Retour à la liste
      </a>
    </div>
  </main>
</Layout>

<style>
  h1 {
    transition: color 0.3s ease-in-out;
  }

  h1:hover {
    color: #1d4ed8; 
  }
</style>
